<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="view.macro('arche:templates/base_view.pt', 'arche:templates/inline.pt')">
<body>
<metal:actionbar fill-slot="actionbar"></metal:actionbar>

<div metal:fill-slot="main-content">

    <h1>
        Röstprotokoll
        <small> för ${context.title}</small>
    </h1>
    <p>För att ett förslag ska anses ha stöd behöver följande kriterier uppfyllas:</p>
    <ul>
        <li>Minst 1/3 av närvarande kommuner</li>
        <li>Minst 1/3 av närvarande regioner</li>
        <li>Minst 50% av totala rösterna</li>
    </ul>

    <tal:error condition="error|False">
        <p>${error}</p>
    </tal:error>

    <p><a href="${request.resource_url(context)}" class="btn btn-default">Tillbaka</a></p>

    <h2>Förslag och röstfördelning</h2>
    <tal:display condition="not error|True">
        <div class="list-group">
            <tal:iter repeat="prop context.get_proposal_objects()">
                <div class="list-group-item">
                    <span tal:replace="structure request.creators_info(prop.creators, portrait = False)">userinfo</span>
                    <span tal:content="structure request.render_proposal_text(prop)">Text here</span>
                    <p>FörslagsID: #${prop.aid}</p>

                    <tal:defs define="vote_count view.vote_count(prop.uid);
                                percentages view.percentages(vote_count);
                                colouring view.colouring(percentages);">

                        <tal:iter repeat="(cat, title) view_cats">
                            <div class="row">
                                <div class="col-xs-4">${title}:</div>
                                <div class="col-xs-4 text-center">${percentages[cat]}%</div>
                                <div class="col-xs-4 text-right">${vote_count[cat]} / ${view.total_vote_power[cat]}
                                </div>
                            </div>

                            <div class="progress">
                                <div class="progress-bar progress-bar-${colouring[cat]}" role="progressbar"
                                     aria-valuenow="${percentages[cat]}"
                                     aria-valuemin="0" aria-valuemax="100" style="width: ${percentages[cat]}%"></div>
                            </div>

                        </tal:iter>
                    </tal:defs>
                </div>
            </tal:iter>
        </div>
    </tal:display>

</div>
</body>
</html>
